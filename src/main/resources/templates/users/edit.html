<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="fragments/head :: head"></head>

<body>
  <header th:replace="fragments/navbar :: navbar"></header>

  <section class="section">
    <div class="container">
      <div class="columns is-centered">
        <div class="column is-half">
          <div class="box">
            <h1 class="title" th:text="${page.title}">Editar usuario</h1>

            <form th:action="@{'/users/edit/' + ${userId}}" method="post">
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

              <div class="field">
                <label class="label">Usuario</label>
                <div class="control has-icons-left">
                  <input class="input" type="text" name="username" th:value="${user.username}" required />
                  <span class="icon is-small is-left">
                    <i class="fa-solid fa-user"></i>
                  </span>
                </div>
              </div>

              <div class="field">
                <label class="label">DNI</label>
                <div class="control has-icons-left">
                  <input class="input" type="number" name="dni" th:value="${user.dni}" required />
                  <span class="icon is-small is-left">
                    <i class="fa-solid fa-id-card"></i>
                  </span>
                </div>
              </div>

              <div class="field">
                <label class="label">Nombre</label>
                <div class="control has-icons-left">
                  <input class="input" type="text" name="nombre" th:value="${user.nombre}" required />
                  <span class="icon is-small is-left">
                    <i class="fa-solid fa-signature"></i>
                  </span>
                </div>
              </div>

              <div class="field">
                <label class="label">Apellido</label>
                <div class="control has-icons-left">
                  <input class="input" type="text" name="apellido" th:value="${user.apellido}" required />
                  <span class="icon is-small is-left">
                    <i class="fa-solid fa-signature"></i>
                  </span>
                </div>
              </div>

              <div class="field">
                <label class="label">Rol</label>
                <div class="control">
                  <div class="select is-fullwidth">
                    <select name="role" th:disabled="${editingSelf}">
                      <option th:each="r : ${roles}" th:value="${r.name()}" th:text="${r.name()}"
                        th:selected="${r.name()==user.role}"></option>
                    </select>
                  </div>
                  <!-- Si está deshabilitado, enviar el valor actual en un campo oculto -->
                  <input type="hidden" th:if="${editingSelf}" name="role" th:value="${user.role}" />
                </div>
                <p class="help" th:if="${editingSelf}">No puedes cambiar tu propio rol</p>
              </div>

              <div class="field">
                <label class="label">Estado</label>
                <div class="control">
                  <label class="checkbox">
                    <input type="checkbox" name="enabled" th:checked="${user.enabled}" th:disabled="${editingSelf}" />
                    Usuario habilitado
                  </label>
                </div>
                <!-- Si está deshabilitado, enviar el valor actual en un campo oculto -->
                <input type="hidden" th:if="${editingSelf}" name="enabled" th:value="${user.enabled}" />
                <p class="help" th:if="${editingSelf}">No puedes cambiar tu propio estado</p>
                <p class="help" th:unless="${editingSelf}">Desmarcar para deshabilitar el acceso del usuario al sistema
                </p>
              </div>

              <div class="field is-grouped">
                <div class="control">
                  <button type="submit" class="button is-primary">
                    <span class="icon">
                      <i class="fa-solid fa-save"></i>
                    </span>
                    <span>Guardar Cambios</span>
                  </button>
                </div>
                <div class="control">
                  <a class="button is-light" th:href="@{/users}">Cancelar</a>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </section>

</body>

</html>