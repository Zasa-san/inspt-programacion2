<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="~{fragments/head :: head}"></head>

<body>
  <header th:replace="~{fragments/navbar :: navbar}"></header>

  <section class="section">
    <div class="container">
      <h1 class="title" th:text="${page.title}">Productos</h1>
      <p class="subtitle" th:text="${page.description}">Administración de productos</p>

      <div th:if="${successMessage != null}" class="notification is-success" th:text="${successMessage}"></div>
      <div th:if="${errorMessage != null}" class="notification is-danger" th:text="${errorMessage}"></div>

      <div class="mb-4">
        <a class="button is-primary" th:href="@{/products/new}">Nuevo producto</a>
      </div>

      <div th:if="${#lists.isEmpty(products)}">
        <p>No hay productos cargados.</p>
      </div>

      <div th:if="${!#lists.isEmpty(products)}">
        <table class="table is-fullwidth is-striped is-hoverable">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Descripción</th>
              <th class="has-text-right">Precio</th>
              <th>Imagen</th>
              <th>Estado</th>
              <th class="has-text-centered">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="p : ${products}">
              <td th:text="${p.name}">Nombre</td>
              <td th:text="${p.description}">Descripción</td>
              <td class="has-text-right">
                $ <span class="price-format" th:attr="data-price=${p.precioBase}">0</span>
              </td>
              <td>
                <span th:if="${p.imgUrl != null}">
                  <img th:src="@{${p.imgUrl}}" alt="img" style="height:48px; width:48px; object-fit:cover;" />
                </span>
                <span th:if="${p.imgUrl == null}">-</span>
              </td>
              <td>
                <span class="tag" th:classappend="${p.available ? 'is-success' : 'is-danger'}"
                  th:text="${p.available ? 'Disponible' : 'No disponible'}">
                  Estado
                </span>
              </td>
              <td class="has-text-centered">
                <div class="buttons is-centered">
                  <a class="button is-small is-info" th:href="@{/products/edit/{id}(id=${p.id})}" title="Editar">
                    <span class="icon is-small">
                      <i class="fas fa-edit"></i>
                    </span>
                  </a>

                  <form th:action="@{/products/toggle-availability/{id}(id=${p.id})}" method="post"
                    style="display:inline;">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <button class="button is-small" th:classappend="${p.available ? 'is-warning' : 'is-success'}"
                      th:title="${p.available ? 'Marcar no disponible' : 'Marcar disponible'}" type="submit">
                      <span class="icon is-small">
                        <i class="fas" th:classappend="${p.available ? 'fa-eye-slash' : 'fa-eye'}"></i>
                      </span>
                    </button>
                  </form>

                  <form th:action="@{/products/delete/{id}(id=${p.id})}" method="post" style="display:inline;"
                    onsubmit="return confirm('¿Está seguro que desea eliminar este producto?');">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <button class="button is-small is-danger" title="Eliminar" type="submit">
                      <span class="icon is-small">
                        <i class="fas fa-trash"></i>
                      </span>
                    </button>
                  </form>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <script th:src="@{/js/products/precioHandler.js}" defer></script>
</body>

</html>
