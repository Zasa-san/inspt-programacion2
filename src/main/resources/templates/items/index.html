<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="~{fragments/head :: head}"></head>

<body>
  <header th:replace="~{fragments/navbar :: navbar}"></header>

  <section class="section">
    <div class="container">
      <div class="level">
        <div class="level-left">
          <div class="level-item">
            <div>
              <h1 class="title" th:text="${page.title}">Items</h1>
              <p class="subtitle" th:text="${page.description}">Gestión de items de stock</p>
            </div>
          </div>
        </div>
        <div class="level-right">
          <div class="level-item">
            <a href="/stock" class="button is-light">
              <span class="icon is-small">
                <i class="fas fa-arrow-left"></i>
              </span>
              <span>Volver a stock</span>
            </a>
          </div>
          <div class="level-item">
            <a href="/items/nuevo" class="button is-primary">
              <span class="icon is-small">
                <i class="fas fa-plus"></i>
              </span>
              <span>Crear nuevo item</span>
            </a>
          </div>
        </div>
      </div>

      <div th:if="${successMessage != null}" class="notification is-success" th:text="${successMessage}"></div>
      <div th:if="${errorMessage != null}" class="notification is-danger" th:text="${errorMessage}"></div>

      <div th:if="${#lists.isEmpty(items)}">
        <p>No hay items cargados.</p>
      </div>

      <div th:if="${!#lists.isEmpty(items)}">
        <table class="table is-fullwidth is-striped is-hoverable">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Descripción</th>
              <th class="has-text-right">Precio</th>
              <th class="has-text-centered">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="item : ${items}">
              <td th:text="${item.name}">Nombre</td>
              <td th:text="${item.descripcion}">Descripción</td>
              <td class="has-text-right">
                $ <span class="price-format" th:attr="data-price=${item.price}">0</span>
              </td>
              <td class="has-text-centered">
                <div class="buttons are-small">
                  <a th:href="@{'/items/editar/' + ${item.id}}" class="button is-info is-small">
                    <span class="icon is-small">
                      <i class="fas fa-edit"></i>
                    </span>
                    <span>Editar</span>
                  </a>
                  <form th:action="@{'/items/eliminar/' + ${item.id}}" method="post" style="display: inline;">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <button type="submit" class="button is-danger is-small"
                      onclick="return confirm('¿Está seguro de que desea eliminar este item?');">
                      <span class="icon is-small">
                        <i class="fas fa-trash"></i>
                      </span>
                      <span>Eliminar</span>
                    </button>
                  </form>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <script th:src="@{/js/products/precioHandler.js}" defer></script>
</body>

</html>