<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="~{fragments/head :: head}"></head>

<body>
  <header th:replace="~{fragments/navbar :: navbar}"></header>

  <section class="section">
    <div class="container">
      <h1 class="title" th:text="${page.title}">Stock de productos</h1>
      <p class="subtitle" th:text="${page.description}">Gestión de stock por producto</p>

      <div th:if="${successMessage != null}" class="notification is-success" th:text="${successMessage}"></div>
      <div th:if="${errorMessage != null}" class="notification is-danger" th:text="${errorMessage}"></div>

      <div th:if="${#lists.isEmpty(productos)}">
        <p>No hay productos cargados.</p>
      </div>

      <div th:if="${!#lists.isEmpty(productos)}">
        <form th:action="@{/stock/movimiento}" method="post">
          <table class="table is-fullwidth is-striped is-hoverable">
            <thead>
              <tr>
                <th>Producto</th>
                <th>Descripción</th>
                <th class="has-text-right">Precio</th>
                <th class="has-text-centered">Stock actual</th>
                <th class="has-text-centered">Registrar movimiento</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="p : ${productos}">
                <td th:text="${p.name}">Nombre</td>
                <td th:text="${p.description}">Descripción</td>
                <td class="has-text-right">
                  $ <span class="price-format" th:attr="data-price=${p.price}">0</span>
                </td>
                <td class="has-text-centered">
                  <span th:text="${stocks[p.id]}">0</span>
                </td>
                <td>
                  <input type="hidden" name="productoId" th:value="${p.id}" />
                  <div class="columns is-mobile is-vcentered">
                    <div class="column is-4">
                      <div class="select is-small">
                        <select name="tipo">
                          <option th:value="${T(inspt_programacion2_kfc.backend.models.stock.TipoMovimiento).ENTRADA}">
                            Entrada
                          </option>
                          <option th:value="${T(inspt_programacion2_kfc.backend.models.stock.TipoMovimiento).SALIDA}">
                            Salida
                          </option>
                        </select>
                      </div>
                    </div>
                    <div class="column is-3">
                      <input class="input is-small" type="number" name="cantidad" min="0" value="0" />
                    </div>
                    <div class="column is-5">
                      <input class="input is-small" type="text" name="motivo" placeholder="Motivo (opcional)" />
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>

          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
          <div class="field has-text-right">
            <div class="control">
              <button type="submit" class="button is-link">
                Aplicar cambios
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </section>

  <script th:src="@{/js/products/precioHandler.js}" defer></script>
</body>

</html>